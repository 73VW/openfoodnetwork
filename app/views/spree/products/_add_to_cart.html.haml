.add-to-cart
  - if !@product.has_stock? && !Spree::Config[:allow_backorders]
    = content_tag('strong', t(:out_of_stock))

  - elsif current_order(false) && !current_order(false).can_add_product_to_cart?(@product)
    %p= "Please complete your order at #{current_distributor.name} before shopping with another distributor."

  - else
    %p Quantity
    = number_field_tag (@product.has_variants? ? :quantity : "variants[#{@product.master.id}]"), 1, :class => 'title', :in => 1..@product.on_hand
    - order = current_order(false)
    - if order.nil? || order.can_change_distributor?
      %p Distributor
      = select_tag "distributor_id", options_from_collection_for_select(@product.distributors, "id", "name", current_distributor.andand.id)
    - else
      %p= "Your distributor for this order is #{order.distributor.name}"
    %br/
    = button_tag :class => 'large primary', :id => 'add-to-cart-button', :type => :submit do
      = t(:add_to_cart)

