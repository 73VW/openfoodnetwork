.add-to-cart
  - order = current_order(false)

  - if product_out_of_stock
    = content_tag('strong', t(:out_of_stock))

  - elsif product_incompatible_with_current_order(order, @product)
    = render 'add_to_cart_distributor_unavailable'

  - else
    = render 'add_to_cart_quantity_fields', product: @product

    %div.cleared
      %br
      - available_distributors = available_distributors_for(order, @product)
      - if available_distributors.length > 1 || order.andand.distributor.nil?
        = render 'add_to_cart_distributor_choice', distributor_collection: available_distributors

      - else
        - distributor = available_distributors.first
        - changing_distributor = distributor != order.andand.distributor
        = render 'add_to_cart_distributor_fixed', distributor: distributor, changing_distributor: changing_distributor

    %br
    = button_tag :class => 'large primary', :id => 'add-to-cart-button', :type => :submit do
      = t(:add_to_cart)
