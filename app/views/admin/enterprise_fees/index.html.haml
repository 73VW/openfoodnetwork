- content_for :head do
  = javascript_include_tag "http://ajax.googleapis.com/ajax/libs/angularjs/1.0.2/angular.min.js"

= angular_form_for @enterprise_fee_set, :url => main_app.bulk_update_admin_enterprise_fees_path do |enterprise_fee_set_form|
  - if @enterprise_fee_set.errors.present?
    %h2 Errors
    %ul
      - @enterprise_fee_set.errors.each do |error|
        %li= error
  %table.index#listing_enterprise_fees{'ng-app' => '', 'ng-controller' => 'AdminEnterpriseFeesCtrl'}
    %thead
      %tr
        %th Enterprise
        %th Fee Type
        %th Name
        %th Calculator
        %th Calculator values
        %th
    %tbody
      / -- Finished product
      = enterprise_fee_set_form.angular_fields_for :collection do |f|
        %tr{'ng-repeat' => 'enterprise_fee in enterprise_fees'}
          %td= f.angular_collection_select :enterprise_id, Enterprise.all, :id, :name, 'enterprise_fee.enterprise_id', :include_blank => true
          %td= f.angular_select :fee_type, enterprise_fee_type_options, 'enterprise_fee.fee_type'
          %td= f.angular_text_field :name
          %td= f.angular_collection_select :calculator_type, @calculators, :name, :description, 'enterprise_fee.calculator_type', {:class => 'calculator_type'}

      / -- Manual HTML / form_tag
      %tr{'ng-repeat' => 'enterprise_fee in enterprise_fees'}
        %td
          %select{:id => 'enterprise_fee_set_collection_attributes_{{ $index }}_enterprise_id', :name => "enterprise_fee_set[collection_attributes][{{ $index }}][enterprise_id]", 'ng-model' => 'enterprise_fee'}
            %option{:value => ""}
            - Enterprise.all.each do |enterprise|
              %option{:value => enterprise.id, 'ng-selected' => "enterprise_fee.enterprise_id == #{enterprise.id}"}= enterprise.name
        %td= select_tag :fee_type, angular_options_for_select(enterprise_fee_type_options, 'enterprise_fee.fee_type')
        %td= text_field_tag 'enterprise_fee_set[collection_attributes][{{ $index }}][name]', '{{ enterprise_fee.name }}', :id => 'enterprise_fee_set_collection_attributes_{{ $index }}_name'
        %td {{ enterprise_fee.calculator_type }}

      / -- Plain old Rails
      = enterprise_fee_set_form.fields_for :collection do |f|
        - enterprise_fee = f.object
        %tr
          %td= f.collection_select :enterprise_id, Enterprise.all, :id, :name, :include_blank => true
          %td= f.select :fee_type, enterprise_fee_type_options
          %td= f.text_field :name
          %td= f.collection_select :calculator_type, @calculators, :name, :description, {}, {:class => 'calculator_type'}
          %td
            - if !enterprise_fee.new_record?
              .calculator-settings
                = f.fields_for :calculator do |calculator_form|
                  = preference_fields(enterprise_fee.calculator, calculator_form)
          %td= link_to_delete enterprise_fee unless enterprise_fee.new_record?
  = enterprise_fee_set_form.submit 'Update'
